<!DOCTYPE html>
<html>
  <head>
    
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta http-equiv="x-dns-prefetch-control" content="on" />
    <title>H·ªá th·ªëng ki·ªÉm tra</title>

    <style>
      :root {
        --font-sf-text: system-ui, -apple-system, BlinkMacSystemFont,
          "SF Pro Text", "SF Pro", "Helvetica Neue", Arial, sans-serif;
        --font-sf-display: system-ui, -apple-system, BlinkMacSystemFont,
          "SF Pro Display", "SF Pro", "Helvetica Neue", Arial, sans-serif;

        /* Dark defaults */
        --bg: radial-gradient(circle at top, #020617, #020617 60%);
        --text: #e5e7eb;
        --muted: #9ca3af;

        --panel: rgba(15, 23, 42, 0.96);
        --panel-border: rgba(148, 163, 184, 0.3);

        --field-bg: rgba(15, 23, 42, 0.95);
        --field-border: #4b5563;
        --field-text: #f9fafb;

        --card-border: #334155;

        --green: #22c55e;
        --green-2: #4ade80;

        /* Perf: reduce extremely heavy shadow by default (still looks premium) */
        --shadow-strong: 0 12px 28px rgba(15, 23, 42, 0.55);
      }

      * { box-sizing: border-box; font-family: var(--font-sf-text); }
      html { -webkit-text-size-adjust: 100%; }
      body{
        margin:0; padding:0;
        min-height:100vh;
        display:flex; flex-direction:column;
        background: var(--bg);
        color: var(--text);
        -webkit-font-smoothing: antialiased;
        /* Perf: optimizeLegibility can be expensive on long pages */
        text-rendering: auto;
        overflow-x:hidden;
      }

      /* Perf: avoid expensive transitions on full-page paint */
      @media (prefers-reduced-motion: reduce){
        *, *::before, *::after { animation: none !important; transition: none !important; scroll-behavior: auto !important; }
      }

      button, input { font: inherit; }

      .app{
        flex:1;
        display:flex;
        min-height:100%;
        padding:24px 28px;
        gap:20px;
        width:100%;
        max-width:100%;
      }

      .panel{
        border-radius:20px;
        padding:20px 22px;
        background: var(--panel);
        border: 1px solid var(--panel-border);
        box-shadow: var(--shadow-strong);
        overflow:hidden;
        /* Perf: isolate layout/paint */
        contain: layout paint style;
      }

      .panel-left{ flex:1.7; display:flex; flex-direction:column; gap:16px; }
      .panel-right{ flex:1.3; display:flex; flex-direction:column; gap:8px; }

      /* Typography */
      .ojt-title, .title-main, .right-title, .result-title{
        font-family: var(--font-sf-display);
        letter-spacing: -0.02em;
      }
      .subtitle, .small, .note-list, .right-note, .lesson-status,
      .login-label, .leader-label, .lesson-search-label, .footer-bar,
      .quiz-timer, .btn-primary, .btn-submit, .btn-lesson, .btn-logout, .btn-close{
        font-family: var(--font-sf-text);
        letter-spacing: -0.01em;
      }

      .ojt-title{
        display:inline-flex; align-items:center;
        padding:12px 24px; border-radius:999px;
        font-size:26px; color:#f9fafb;
        margin-bottom:8px; letter-spacing:0.04em;
        background: linear-gradient(135deg, #064e3b, #020617);
        border:1px solid rgba(52, 211, 153, 0.5);
        box-shadow:0 10px 22px rgba(15, 23, 42, 0.55);
        font-weight:700;
      }

      .title-main{ font-size:18px; margin-bottom:4px; color:#cbd5f5; font-weight:650; }
      .subtitle{ font-size:14px; color:var(--muted); }

      .login-section{
        margin-top:12px;
        max-width:640px;
        padding:14px 16px;
        border-radius:18px;
        border:1px solid rgba(52, 211, 153, 0.35);
        background: radial-gradient(circle at top left, rgba(22, 163, 74, 0.18), #020617 75%);
      }

      .login-row{ display:flex; flex-wrap:wrap; gap:10px; align-items:flex-end; }
      .login-field{ display:flex; flex-direction:column; gap:4px; flex:2; min-width:210px; }
      .login-field.small{ flex:1.1; min-width:140px; }
      .login-label{ font-size:13px; color:#e5e7eb; font-weight:600; }

      .input-text{
        width:100%;
        padding:8px 12px;
        border-radius:10px;
        border:1px solid var(--field-border);
        background: var(--field-bg);
        color: var(--field-text);
        font-size:14px;
        outline:none;
      }
      .input-text:focus{
        border-color: var(--green);
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.6);
      }

      .login-btn-wrap{ display:flex; align-items:flex-end; }
      .btn-primary{
        padding:8px 18px;
        border-radius:999px;
        border:none;
        font-size:13px;
        cursor:pointer;
        background: linear-gradient(90deg, var(--green), var(--green-2));
        color:#052e16;
        white-space:nowrap;
        box-shadow: 0 0 14px rgba(34, 197, 94, 0.28);
      }
      .btn-primary:disabled{ opacity:0.6; cursor:default; box-shadow:none; }

      .login-info{ margin-top:8px; font-size:13px; color:#bbf7d0; }
      .login-info.error{ color:#fecaca; }
      .note-list{ margin-top:6px; padding-left:18px; font-size:11px; color:var(--muted); }

      .quiz-header{
        margin-top:14px;
        padding:12px 13px;
        border-radius:18px;
        background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.08), #020617 70%);
        border:1px solid var(--card-border);
        font-size:13px;
      }

      .quiz-header-top{
        display:flex;
        justify-content:space-between;
        gap:12px;
        align-items:flex-start;
      }

      .quiz-card{
        margin-top:10px;
        padding:12px 14px;
        border-radius:18px;
        background: radial-gradient(circle at top left, rgba(15, 118, 110, 0.12), #020617 75%);
        border:1px solid var(--field-border);
      }

      .question-item{ margin-bottom:14px; }
      .question-title{ font-size:15px; margin-bottom:6px; font-weight:600; }
      .options-group{ margin-left:4px; font-size:13px; }
      .option-row{ display:flex; align-items:flex-start; gap:8px; margin-bottom:6px; line-height:1.35; }
      .option-row input[type="radio"]{ margin-top:2px; accent-color: var(--green); }

      .btn-submit{
        margin-top:0;
        border:none;
        background: linear-gradient(90deg, var(--green), var(--green-2));
        color:#052e16;
        font-size:14px;
        font-weight:600;
        cursor:pointer;
        box-shadow: 0 0 14px rgba(34, 197, 94, 0.28);
        border-radius:999px;
        padding:0 22px;
        height:40px;
        min-width:auto;
      }
      .btn-submit:disabled{ opacity:0.6; cursor:default; box-shadow:none; }

      .right-header-row{ display:flex; justify-content:space-between; align-items:flex-start; gap:8px; }
      .right-header-tag{
        display:inline-block;
        padding:4px 12px;
        border-radius:999px;
        border:1px solid var(--field-border);
        font-size:12px;
        letter-spacing:0.12em;
        text-transform:uppercase;
        font-weight:600;
      }
      .right-title{ margin-top:8px; font-size:20px; font-weight:700; }
      .right-subtitle{ margin-top:4px; font-size:14px; color:var(--muted); margin-bottom:6px; }
      .btn-logout{
        padding:5px 12px;
        border-radius:999px;
        border:1px solid var(--field-border);
        background: rgba(15, 23, 42, 0.9);
        color:#e5e7eb;
        font-size:12px;
        cursor:pointer;
        white-space:nowrap;
      }

      .progress-summary{
        margin-top:10px;
        padding:10px 12px;
        border-radius:14px;
        background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.14), rgba(15, 23, 42, 0.96));
        border:1px solid rgba(148, 163, 184, 0.6);
        box-shadow:0 8px 18px rgba(15, 23, 42, 0.45);
        font-size:11px;
      }

      .progress-summary-header{
        font-size:12px;
        font-weight:600;
        margin-bottom:6px;
        letter-spacing:0.08em;
        text-transform:uppercase;
        color:#bfdbfe;
      }
      .progress-summary-bar{ margin-bottom:6px; }
      .progress-bar-track{
        width:100%;
        height:6px;
        border-radius:999px;
        background: rgba(30, 64, 175, 0.6);
        overflow:hidden;
      }
      .progress-bar-fill{
        height:100%;
        border-radius:inherit;
        background: linear-gradient(90deg, var(--green), #a3e635);
        transition: width 0.25s ease;
      }
      .progress-summary-meta{
        display:flex;
        justify-content:space-between;
        gap:6px;
        flex-wrap:wrap;
        color:#e5e7eb;
        opacity:0.95;
      }

      .leader-card{
        margin-top:8px;
        padding:10px 14px;
        border-radius:18px;
        background: radial-gradient(circle at top left, rgba(250, 204, 21, 0.06), #020617 82%);
        border:1px solid rgba(250, 204, 21, 0.22);
        font-size:12px;
        box-shadow: 0 0 14px rgba(250, 204, 21, 0.10);
        position:relative;
        overflow:hidden;
      }
      .leader-card-title{
        font-family: var(--font-sf-display);
        font-size:12px;
        font-weight:700;
        margin-bottom:6px;
        letter-spacing:0.12em;
        text-transform:uppercase;
        color:#facc15;
      }
      .leader-row{ margin-bottom:3px; }
      .leader-label{ color:var(--muted); }
      .leader-value{ color:#e5e7eb; font-weight:500; }
      #leaderName{ color:#fef9c3; font-weight:700; font-size:14px; }

      .lesson-list{
        margin-top:10px;
        display:flex;
        flex-direction:column;
        gap:7px;
        max-height:460px;
        overflow-y:auto;
        padding-right:4px;
        content-visibility: auto;
        contain-intrinsic-size: 460px;
      }

      .lesson-item{
        padding:9px 11px;
        border-radius:16px;
        background: radial-gradient(circle at top left, rgba(16, 185, 129, 0.07), #020617 80%);
        border:1px solid var(--field-border);
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:8px;
      }

      .lesson-main{ flex:1; }
      .lesson-name{ font-size:13px; font-weight:400; }
      .lesson-status{ font-size:12px; color:var(--muted); }
      .lesson-status.pass{ color:#4ade80; font-weight:600; }
      .lesson-status.fail{ color:#f87171; font-weight:600; }

      .btn-lesson{
        padding:6px 13px;
        border-radius:999px;
        border:none;
        font-size:12px;
        font-weight:600;
        cursor:pointer;
        background: rgba(34, 197, 94, 0.15);
        color:#bbf7d0;
        white-space:nowrap;
      }
      .btn-lesson:disabled{ opacity:0.5; cursor:default; box-shadow:none; }

      .lesson-search-wrap{ margin-top:10px; margin-bottom:4px; }
      .lesson-search-label{
        font-size:12px;
        text-transform:uppercase;
        letter-spacing:0.12em;
        color:var(--muted);
        margin-bottom:6px;
        font-weight:600;
      }
      .lesson-search-input{
        width:100%;
        padding:7px 10px;
        border-radius:999px;
        border:1px solid var(--field-border);
        background: rgba(15, 23, 42, 0.95);
        color:#e5e7eb;
        font-size:12px;
        outline:none;
      }
      .lesson-search-input:focus{
        border-color: var(--green);
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.45);
      }

      .right-note{ margin-top:14px; font-size:13px; color:var(--muted); }
      .muted{ opacity:0.8; }
      .small{ font-size:12px; }

      .modal-overlay{
        position:fixed; top:0; left:0;
        width:100%; height:100%;
        background: rgba(0,0,0,0.65);
        display:flex; align-items:center; justify-content:center;
        z-index:999;
      }
      .modal-card{
        width:340px;
        padding:20px;
        border-radius:16px;
        background:#020617;
        border:1px solid var(--card-border);
        text-align:center;
        box-shadow:0 8px 24px rgba(0,0,0,0.35);
        animation: fadeIn 0.18s ease-out;
      }
      .result-title{ font-size:19px; margin-bottom:10px; font-weight:600; }
      .result-details{ font-size:14px; line-height:1.6; color:#e2e8f0; margin-bottom:16px; }
      .btn-close{
        padding:7px 18px;
        border-radius:999px;
        background: var(--green);
        border:none;
        color:#052e16;
        font-weight:600;
        cursor:pointer;
        font-size:13px;
      }
      .modal-card.pass{ border:1px solid #16a34a; box-shadow:0 0 14px rgba(34,197,94,0.25); }
      .modal-card.fail{ border:1px solid #dc2626; box-shadow:0 0 14px rgba(239,68,68,0.22); }
      .result-title.pass{ color:#4ade80; }
      .result-title.fail{ color:#f87171; }
      @keyframes fadeIn{ from{opacity:0; transform:translateY(6px) scale(0.985);} to{opacity:1; transform:translateY(0) scale(1);} }

      @media (max-width:1024px){
        .app{ flex-direction:column; }
        .panel{ padding:16px; }
        .login-section{ max-width:100%; }
      }
      @media (max-width:480px){
        .app{ padding:12px 12px; }
        .panel{ padding:14px; border-radius:18px; }
        .ojt-title{ font-size:20px; padding:8px 14px; }
        .title-main{ font-size:15px; }
        .subtitle{ font-size:12px; }
        .lesson-list{ max-height:330px; contain-intrinsic-size: 330px; }
      }

      /* Footer */
      .footer-bar{
        border-top:1px solid rgba(148,163,184,0.2);
        padding:10px 20px 14px;
        font-size:12px;
        color:#94a3b8;
        display:flex;
        justify-content:space-between;
        align-items:center;
        gap:8px;
        background: linear-gradient(90deg, rgba(15,23,42,0.96), rgba(15,23,42,0.98));
      }
      .footer-right a{ color: var(--green); text-decoration:none; }
      .footer-right a:hover{ text-decoration:underline; }

      .footer-right{
        display:flex;
        align-items:center;
        justify-content:flex-end;
        gap:10px;
        flex-wrap:wrap;
      }

      .theme-toggle{
        display:inline-flex;
        align-items:center;
        gap:8px;
        margin-right:2px;
        font-size:12px;
        line-height:20px;
      }
      .theme-toggle-label{
        color:#cbd5f5;
        display:inline-flex;
        align-items:center;
        height:20px;
        line-height:20px;
        font-size:12px;
      }

      .switch{ position:relative; display:inline-block; width:38px; height:20px; flex:0 0 auto; }
      .switch input{ opacity:0; width:0; height:0; }
      .slider{
        position:absolute; cursor:pointer; inset:0;
        background-color:#4b5563;
        transition:0.18s;
        border-radius:999px;
        box-shadow: 0 0 0 1px rgba(15,23,42,0.55), 0 6px 14px rgba(15,23,42,0.55);
      }
      .slider:before{
        position:absolute; content:"";
        height:16px; width:16px; left:2px; top:2px;
        background: radial-gradient(circle at 30% 20%, #ffffff, #e5e7eb);
        transition:0.18s;
        border-radius:50%;
        box-shadow:0 3px 6px rgba(15,23,42,0.45);
      }
      .switch input:checked + .slider{
        background: linear-gradient(120deg, var(--green), var(--green-2), #a7f3d0);
        box-shadow: 0 0 0 1px rgba(22,163,74,0.55), 0 8px 18px rgba(34,197,94,0.35);
      }
      .switch input:checked + .slider:before{ transform: translateX(18px); }

      @media (max-width:640px){
        .footer-bar{ flex-direction:column; text-align:center; }
        .footer-left, .footer-right{ text-align:center; white-space:normal; }
        .footer-right{ justify-content:center; }
      }

      /* Quiz area scroll */
      .quiz-area{
        margin-top:14px;
        display:flex;
        flex-direction:column;
        gap:10px;
        max-height:72vh;
        overflow-y:auto;
        padding-right:6px;
        content-visibility: auto;
        contain-intrinsic-size: 900px;
      }

      /* Submit bar (sticky) */
      .quiz-submit-bar{
        position: sticky;
        bottom: 0;
        z-index: 11;
        padding: 12px 0 6px;
        background: linear-gradient(to top, rgba(15,23,42,0.96), rgba(15,23,42,0.3));
        display:flex;
        align-items:center;
        justify-content:flex-end;
        gap:12px;
      }

      #quizTimer.quiz-timer-inline{
        height:40px;
        padding:0 16px;
        display:inline-flex;
        align-items:center;
        gap:6px;
        font-size:14px;
        font-weight:600;
        border-radius:999px;
        border:2px solid var(--green);
        color:#bbf7d0;
        background: rgba(15,23,42,0.9);
        margin-top:0;
        box-shadow:none;
      }
      #quizTimer .quiz-timer-label{ font-variant-numeric: tabular-nums; }

      #quizTimer.danger{ border-color: rgba(248,113,113,0.9); color:#fecaca; }

      /* Light mode */
      body.light-mode{
        --bg: radial-gradient(circle at top, #f5f5f7, #ffffff 60%);
        --text: #111827;
        --muted: #6b7280;

        --panel: radial-gradient(circle at top left, rgba(255,255,255,0.98), #f9fafb);
        --panel-border: rgba(209,213,219,0.9);

        --field-bg: rgba(255,255,255,0.98);
        --field-border: #d1d5db;
        --field-text: #111827;

        --card-border: #e5e7eb;

        --shadow-strong: none;
      }

      body.light-mode .ojt-title{
        background: linear-gradient(135deg, #ecfdf5, #eff6ff);
        color:#064e3b;
        border-color: rgba(22,163,74,0.55);
        box-shadow:none;
      }
      body.light-mode .title-main{ color:#111827; font-weight:700; }
      body.light-mode .login-section{
        background: rgba(255,255,255,0.92) !important;
        border-color: rgba(209,213,219,0.95);
        box-shadow:none;
      }
      body.light-mode .login-label{ color:#374151; }

      body.light-mode .quiz-header{
        background: linear-gradient(180deg, rgba(239,246,255,0.95), rgba(255,255,255,0.92));
        border-color: var(--card-border);
      }
      body.light-mode .quiz-card{
        background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(248,250,252,0.98));
        border-color: var(--card-border);
      }

      body.light-mode .progress-summary{
        background: linear-gradient(180deg, rgba(239,246,255,0.98), rgba(255,255,255,0.98));
        border-color:#bfdbfe;
        box-shadow:none;
      }
      body.light-mode .progress-summary-header{ color:#1d4ed8; }
      body.light-mode .progress-bar-track{ background: rgba(191, 219, 254, 0.9); }
      body.light-mode .progress-summary-meta{ color:#111827; opacity:0.92; }

      body.light-mode .leader-card{
        background: linear-gradient(180deg, rgba(255,253,247,0.98), rgba(255,255,255,0.98));
        border-color: rgba(250,204,21,0.35);
        box-shadow:none;
      }
      body.light-mode .leader-card-title{ color:#b45309; }
      body.light-mode .leader-value{ color:#111827; }
      body.light-mode #leaderName{ color:#92400e; }

      body.light-mode .lesson-item{
        background: rgba(255,255,255,0.98);
        border-color: var(--card-border);
        box-shadow:none;
      }
      body.light-mode .lesson-status.pass{ color:#16a34a; }
      body.light-mode .lesson-status.fail{ color:#dc2626; }

      body.light-mode .lesson-search-input{
        background: rgba(255,255,255,0.98);
        border-color: var(--field-border);
        color: var(--field-text);
      }

      body.light-mode .right-header-tag{
        border-color: var(--field-border);
        color:#374151;
        background: rgba(255,255,255,0.7);
      }
      body.light-mode .btn-logout{
        background: rgba(255,255,255,0.85);
        color:#111827;
        border-color: var(--field-border);
      }
      body.light-mode .btn-lesson{
        background: rgba(34, 197, 94, 0.12);
        color:#065f46;
      }

      body.light-mode .quiz-submit-bar{
        background: linear-gradient(to top, rgba(255,255,255,0.98), rgba(255,255,255,0.6));
        border-top: 1px solid rgba(229,231,235,0.9);
      }
      body.light-mode #quizTimer.quiz-timer-inline{
        background:#ecfdf5;
        color:#065f46;
        border-color: var(--green);
      }

      body.light-mode .modal-overlay{ background: rgba(17, 24, 39, 0.45); }
      body.light-mode .modal-card{
        background: rgba(255,255,255,0.98);
        border-color: rgba(209,213,219,0.9);
        box-shadow: 0 14px 32px rgba(17,24,39,0.12);
      }
      body.light-mode .result-details{ color:#111827; }
      body.light-mode .footer-bar{
        background: linear-gradient(90deg, rgba(255,255,255,0.96), rgba(248,250,252,0.98));
        border-top-color: rgba(209,213,219,0.9);
        color:#6b7280;
        box-shadow:none;
      }
      body.light-mode .theme-toggle-label{ color:#111827; }
      body.light-mode .slider{ box-shadow:none; background:#e5e7eb; }
      body.light-mode .slider:before{ box-shadow:none; }

      @media (max-width: 820px){
        html, body{ width:100%; overflow-x:hidden; }
        .app{
          width:100vw;
          max-width:100vw;
          margin:0;
          padding-left:12px;
          padding-right:12px;
        }
        .panel, .panel-left, .panel-right{ width:100%; max-width:100%; margin:0; }
      }

      body.light-mode .login-info{ font-weight:700; color:#065f46; }
    </style>
  </head>

  <body>
    <div class="app">
      <div class="panel panel-left">
        <div>
          <div class="ojt-title">üáªüá≥ H·ªÜ TH·ªêNG ƒê√ÄO T·∫†O OJT ENGINEERING</div>
          <div class="title-main">ƒêƒÉng nh·∫≠p h·ªá th·ªëng ki·ªÉm tra</div>
          <div class="subtitle">
            Vui l√≤ng nh·∫≠p th√¥ng tin b√™n d∆∞·ªõi ƒë·ªÉ ƒëƒÉng nh·∫≠p. Sau khi ƒëƒÉng nh·∫≠p, ch·ªçn b√†i h·ªçc ·ªü khung b√™n
            ph·∫£i ƒë·ªÉ th·ª±c hi·ªán b√†i ki·ªÉm tra.
          </div>

          <div class="login-section">
            <div class="login-row">
              <div class="login-field">
                <label class="login-label" for="fullName">H·ªç v√† t√™n</label>
                <input id="fullName" class="input-text" placeholder="V√≠ d·ª•: NGUY·ªÑN HO√ÄNG TH√îNG" />
              </div>
              <div class="login-field small">
                <label class="login-label" for="employeeId">M√£ s·ªë nh√¢n vi√™n</label>
                <input id="employeeId" class="input-text" placeholder="10106203" />
              </div>
              <div class="login-btn-wrap">
                <button id="btnLogin" class="btn-primary" onclick="onLogin()">ƒêƒÉng nh·∫≠p</button>
              </div>
            </div>

            <div id="loginInfo" class="login-info"></div>

            <ul class="note-list">
              <li>H·ªç t√™n v√† m√£ s·ªë nh√¢n vi√™n ph·∫£i tr√πng ho√†n to√†n v·ªõi d·ªØ li·ªáu t·∫°i sheet <b>Employees</b>.</li>
              <li>Ch·ªâ nh·ªØng nh√¢n vi√™n c√≥ c·ªôt <b>Active = Y</b> m·ªõi ƒë∆∞·ª£c ph√©p l√†m b√†i.</li>
            </ul>
          </div>
        </div>

        <div id="quizArea" class="quiz-area" style="display: none;">
          <div class="quiz-header">
            <div class="quiz-header-top">
              <div>
                <div><b>B√†i h·ªçc:</b> <span id="lessonTitle"></span></div>
                <div>Vui l√≤ng tr·∫£ l·ªùi t·∫•t c·∫£ c√¢u h·ªèi b√™n d∆∞·ªõi, sau ƒë√≥ b·∫•m <b>N·ªôp b√†i</b>.</div>
                <div class="small" style="margin-top: 4px;">
                  Nh√¢n vi√™n: <b><span id="studentName"></span></b> (M√£ NV:
                  <span id="studentId"></span>).
                </div>
              </div>
            </div>
          </div>

          <div id="questionsContainer" class="quiz-card"></div>

          <div class="quiz-submit-bar">
            <div id="quizTimer" class="quiz-timer-inline" style="display:none;">
              ‚è± <span class="quiz-timer-label" id="timerLabel">15:00</span>
            </div>
            <button id="btnSubmitQuiz" class="btn-submit" onclick="onSubmitQuiz()">N·ªôp b√†i</button>
          </div>
        </div>
      </div>

      <div class="panel panel-right">
        <div class="right-header-row">
          <div>
            <div class="right-header-tag">Tr·∫°ng th√°i h·ªçc t·∫≠p</div>
            <div class="right-title">Danh s√°ch b√†i h·ªçc</div>
            <div class="right-subtitle">
              <span id="rightUserName" class="muted"></span>
            </div>
          </div>
          <button id="btnLogout" class="btn-logout" onclick="onLogout()" style="display: none;">
            ƒêƒÉng xu·∫•t
          </button>
        </div>

        <div id="progressSummary" class="progress-summary" style="display:none;">
          <div class="small muted">Ti·∫øn ƒë·ªô h·ªçc t·∫≠p s·∫Ω hi·ªÉn th·ªã sau khi t·∫£i danh s√°ch b√†i h·ªçc.</div>
        </div>

        <div id="leaderBox" style="display: none;">
          <div class="leader-card">
            <div class="leader-card-title">NG∆Ø·ªúI QU·∫¢N L√ù TR·ª∞C TI·∫æP</div>
            <div class="leader-row">
              <span class="leader-label">H·ªç t√™n:&nbsp;</span>
              <span class="leader-value" id="leaderName"></span>
            </div>
            <div class="leader-row">
              <span class="leader-label">Ch·ª©c v·ª•:&nbsp;</span>
              <span class="leader-value" id="leaderPosition"></span>
            </div>
            <div class="leader-row">
              <span class="leader-label">S·ªë ƒëi·ªán tho·∫°i:&nbsp;</span>
              <span class="leader-value" id="leaderPhone"></span>
            </div>
            <div class="leader-row">
              <span class="leader-label">Ghi ch√∫:&nbsp;</span>
              <span class="leader-value" id="leaderNote"></span>
            </div>
          </div>
        </div>

        <div class="right-note" style="margin-top: 12px;">
          ‚Ä¢ M·ªói b√†i ki·ªÉm tra c√≥ th·ªùi gian l√†m b√†i <b style="color:#ef4444;">15 ph√∫t</b>.
          H·∫øt th·ªùi gian, b√†i s·∫Ω ƒë∆∞·ª£c t√≠nh <b style="color:#ef4444;">0 ƒëi·ªÉm (FAIL)</b>.<br>
          ‚Ä¢ Sau khi ho√†n th√†nh, tr·∫°ng th√°i b√†i ki·ªÉm tra s·∫Ω hi·ªÉn th·ªã ƒëi·ªÉm s·ªë v√† k·∫øt qu·∫£
          <b style="color:#22c55e;">PASS</b>/<b style="color:#ef4444;">FAIL</b>.<br>
          ‚Ä¢ M·ªói b√†i ch·ªâ ƒë∆∞·ª£c th·ª±c hi·ªán <b style="color:#ef4444;">1 l·∫ßn</b>.
          N·∫øu c·∫ßn l√†m l·∫°i, vui l√≤ng li√™n h·ªá b·ªô ph·∫≠n ph·ª• tr√°ch.
        </div>

        <div class="lesson-search-wrap">
          <div class="lesson-search-label">T√¨m b√†i h·ªçc theo m√£ (LessonId)</div>
          <input id="lessonSearch" class="lesson-search-input" placeholder="VD: OJT-001, 5S-01..." />
        </div>

        <div id="lessonsList" class="lesson-list">
          <div class="small muted">Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem c√°c b√†i h·ªçc ƒë∆∞·ª£c ph√¢n c√¥ng.</div>
        </div>
      </div>
    </div>

    <div id="resultModal" class="modal-overlay" style="display: none;">
      <div id="resultCard" class="modal-card">
        <div id="resultTitle" class="result-title"></div>
        <div id="resultDetails" class="result-details"></div>
        <button class="btn-close" onclick="closeResultModal()">ƒê√≥ng</button>
      </div>
    </div>

    <div class="footer-bar">
      <div class="footer-left">
        ¬© 2025 Nu√¥i T√¥i ‚Äì Nu√¥i Th√¥ng. Minh b·∫°ch cho vui ƒë·ªùi.
      </div>
      <div class="footer-right">
        <div class="theme-toggle">
          <label class="switch">
            <input type="checkbox" id="themeToggle" />
            <span class="slider"></span>
          </label>
          <span class="theme-toggle-label">Light mode</span>
        </div>

        Code by
        <a href="https://nuoithong.netlify.app/" target="_blank" rel="noopener noreferrer">
          Th√¥ng &amp; C√°c c·ªë v·∫•n ph√°p l√Ω
        </a>.
        T·ª± host, t·ª± ch·ªãu tr√°ch nhi·ªám.
      </div>
    </div>

    <script>
      
      /****************************************************
       * NETLIFY MODE: GAS API (backend) + optional DEMO
       * - Fill GS_API_URL + API_KEY to connect real backend
       ****************************************************/
      const GS_API_URL = "https://script.google.com/macros/s/AKfycbwS4Ied-hI4E1WFoEMLIc48dFIZIDHZ1JAGS3V70y8lDTDXGP1PXJ3MOv4poRYGC6Bv1g/exec";
      const API_KEY    = "TOM-123-SECRET";

      const DEMO_MODE = !GS_API_URL || GS_API_URL.includes("PASTE_YOUR_GAS_WEB_APP_URL_HERE");

      const demoDB = {
          employee: {
            employeeId: '10106203',
            fullName: 'Nguy·ªÖn VƒÉn A (DEMO)',
            leader: { leaderName: 'Mr. Leader', position: 'Supervisor', phone: '0909 000 111', note: 'Demo only' }
          },
          lessons: [
            { lessonId: 'OJT-001', lessonName: 'An to√†n ƒëi·ªán', done: false, statusText: 'Ch∆∞a l√†m' },
            { lessonId: 'OJT-002', lessonName: '5S c∆° b·∫£n', done: true, statusText: 'PASS 90%' },
            { lessonId: 'OJT-003', lessonName: 'TPM nh·∫≠p m√¥n', done: true, statusText: 'FAIL 60%' },
            { lessonId: 'OJT-004', lessonName: 'ISO 50001', done: false, statusText: 'Ch∆∞a l√†m' }
          ],
          questionsByLesson: {
            'OJT-001': [
              { questionId: 'Q1', questionText: 'Khi ph√°t hi·ªán d√¢y ƒëi·ªán h·ªü, m√†y n√™n l√†m g√¨?', options: ['B√°o ngay qu·∫£n l√Ω', 'Ch·∫°m th·ª≠ xem c√≥ ƒëi·ªán', 'B·ªè qua', 'D√°n bƒÉng keo t·∫°m v√† ti·∫øp t·ª•c'] },
              { questionId: 'Q2', questionText: 'Thi·∫øt b·ªã b·∫£o h·ªô t·ªëi thi·ªÉu khi thao t√°c ƒëi·ªán l√†?', options: ['GƒÉng c√°ch ƒëi·ªán', 'D√©p l√™', 'Kh√¥ng c·∫ßn', '√Åo thun'] }
            ],
            'OJT-004': [
              { questionId: 'Q3', questionText: 'EnPI l√† g√¨ trong ISO 50001?', options: ['Energy Performance Indicator', 'Energy Price Index', 'Engine Power Input', 'Kh√¥ng bi·∫øt'] }
            ]
          }
        };

      async function gsCall(action, params = {}) {
        const res = await fetch(GS_API_URL, {
          method: "POST",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify({ apiKey: API_KEY, action, ...params })
        });
        const out = await res.json();
        if (!out || out.ok !== true) throw new Error((out && out.error) || "API error");
        return out.data;
      }

      // Backend adapters (Promise-based)
      function backendLogin(fullName, employeeId) {
        if (DEMO_MODE) {
          return new Promise((resolve, reject) => {
            setTimeout(() => {
              if (!fullName || !employeeId) return reject(new Error("Missing"));
              resolve({
                success: true,
                employee: { ...demoDB.employee, fullName: fullName.trim() + " (DEMO)", employeeId: employeeId.trim() }
              });
            }, 220);
          });
        }
        return gsCall("login", { fullName, employeeId });
      }

      function backendGetLessonsForEmployee(employeeId) {
        if (DEMO_MODE) {
          return new Promise((resolve) => setTimeout(() => resolve(demoDB.lessons), 220));
        }
        return gsCall("getLessonsForEmployee", { employeeId });
      }

      function backendGetQuestions(lessonId) {
        if (DEMO_MODE) {
          return new Promise((resolve) => setTimeout(() => resolve(demoDB.questionsByLesson[lessonId] || []), 240));
        }
        return gsCall("getQuestions", { lessonId });
      }

      function backendSubmitQuiz(payload) {
        if (DEMO_MODE) {
          return new Promise((resolve) => setTimeout(() => {
            const total = (payload.answers || []).length || 1;
            const correct = payload.timeUp ? 0 : Math.max(0, total - Math.floor(Math.random() * 2));
            const scorePercent = Math.round((correct / total) * 100);
            const status = scorePercent >= 80 ? "PASS" : "FAIL";
            resolve({ success:true, correct, total, scorePercent, status, blurCount: payload.blurCount || 0 });
          }, 280));
        }
        // GAS router expects submitQuiz({payload:{...}})
        return gsCall("submitQuiz", { payload });
      }

      let currentEmployee = null;
      let currentLesson = null;
      let currentQuestions = [];
      let timerInterval = null;
      let remainingSeconds = 0;
      const QUIZ_DURATION_SECONDS = 15 * 60;

      let allLessons = [];
      const lastResults = {};
      let blurCount = 0;
      let quizInProgress = false;

      const $ = (id) => document.getElementById(id);

      function setLoginInfo(message, isError) {
        const el = $('loginInfo');
        el.textContent = message || '';
        el.classList.toggle('error', !!isError);
      }

      function setLoginLoading(loading) {
        const btn = $('btnLogin');
        btn.disabled = loading;
        btn.textContent = loading ? 'ƒêang ki·ªÉm tra...' : 'ƒêƒÉng nh·∫≠p';
      }

      function onLogin() {
        const fullName = $('fullName').value.trim();
        const employeeId = $('employeeId').value.trim();

        setLoginInfo('', false);
        if (!fullName || !employeeId) {
          setLoginInfo('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß h·ªç t√™n v√† m√£ s·ªë nh√¢n vi√™n.', true);
          return;
        }

        setLoginLoading(true);
        backendLogin(fullName, employeeId)
          .then(function (res) {
            setLoginLoading(false);
            if (!res || !res.success) {
              setLoginInfo(res && res.message ? res.message : 'Kh√¥ng th·ªÉ ƒëƒÉng nh·∫≠p.', true);
              return;
            }

            currentEmployee = res.employee;

            $('studentName').textContent = currentEmployee.fullName;
            $('studentId').textContent = currentEmployee.employeeId;
            $('rightUserName').textContent = currentEmployee.fullName + ' (M√£ NV: ' + currentEmployee.employeeId + ')';

            $('btnLogout').style.display = 'inline-flex';

            setLoginInfo('ƒêƒÉng nh·∫≠p th√†nh c√¥ng. Vui l√≤ng ch·ªçn b√†i h·ªçc ·ªü khung b√™n ph·∫£i ƒë·ªÉ b·∫Øt ƒë·∫ßu l√†m b√†i.', false);

            renderLeaderInfo(currentEmployee.leader);
            loadLessons();
          })
          .catch(function (err) {
            setLoginLoading(false);
            setLoginInfo('L·ªói h·ªá th·ªëng: ' + (err && err.message ? err.message : err), true);
          });}

      function onLogout() {
        currentEmployee = null;
        currentLesson = null;
        allLessons = [];

        clearTimer();
        hideTimer();

        $('fullName').value = '';
        $('employeeId').value = '';
        $('loginInfo').textContent = '';

        $('quizArea').style.display = 'none';
        $('questionsContainer').innerHTML = '';
        $('lessonTitle').textContent = '';

        $('lessonsList').innerHTML = '<div class="small muted">Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem c√°c b√†i h·ªçc ƒë∆∞·ª£c ph√¢n c√¥ng.</div>';

        $('leaderBox').style.display = 'none';
        $('rightUserName').textContent = '';
        $('btnLogout').style.display = 'none';

        const prog = $('progressSummary');
        if (prog) {
          prog.style.display = 'none';
          prog.innerHTML = '<div class="small muted">Ti·∫øn ƒë·ªô h·ªçc t·∫≠p s·∫Ω hi·ªÉn th·ªã sau khi t·∫£i danh s√°ch b√†i h·ªçc.</div>';
        }

        setLoginInfo('Xin c·∫£m ∆°n b√†i l√†m c·ªßa b·∫°n.', false);
      }

      function renderLeaderInfo(leader) {
        const box = $('leaderBox');
        if (leader && leader.leaderName) {
          $('leaderName').textContent = leader.leaderName;
          $('leaderPosition').textContent = leader.position || '-';
          $('leaderPhone').textContent = leader.phone || '-';
          $('leaderNote').textContent = leader.note || '';
        } else {
          $('leaderName').textContent = 'Ch∆∞a c·∫≠p nh·∫≠t';
          $('leaderPosition').textContent = '-';
          $('leaderPhone').textContent = '-';
          $('leaderNote').textContent = '';
        }
        box.style.display = 'block';
      }

      function renderLessons(list) {
        const listEl = $('lessonsList');
        if (!listEl) return;

        if (!list || !list.length) {
          listEl.innerHTML = '<div class="small muted">Hi·ªán t·∫°i ch∆∞a c√≥ b√†i h·ªçc n√†o ƒë∆∞·ª£c k√≠ch ho·∫°t.</div>';
          updateProgressSummary(list || []);
          return;
        }

        let html = '';
        for (let i = 0; i < list.length; i++) {
          const lesson = list[i];
          const lid = lesson.lessonId ? String(lesson.lessonId).trim() : '';
          const nameText = (lid ? lid + ' - ' : '') + (lesson.lessonName || '');
          const statusText = lesson.statusText || (lesson.done ? 'ƒê√£ ho√†n th√†nh' : 'Ch∆∞a l√†m');
          const upper = String(statusText).toUpperCase();
          const statusClass = upper.startsWith('PASS') ? 'pass' : (upper.startsWith('FAIL') ? 'fail' : '');
          const hasReview = lesson.done && lastResults[lesson.lessonId];
          const btnText = hasReview ? 'Xem l·∫°i' : (lesson.done ? 'ƒê√£ l√†m' : 'L√†m b√†i');
          const btnDisabled = hasReview ? '' : (lesson.done ? 'disabled' : '');
          const dataAction = hasReview ? 'review' : (lesson.done ? 'none' : 'start');

          html +=
            '<div class="lesson-item" data-lessonid="' + (lesson.lessonId || '') + '" data-action="' + dataAction + '">' +
              '<div class="lesson-main">' +
                '<div class="lesson-name">' + escapeHtml(nameText) + '</div>' +
                '<div class="lesson-status ' + statusClass + '">' + escapeHtml(statusText) + '</div>' +
              '</div>' +
              '<button class="btn-lesson" ' + btnDisabled + '>' + btnText + '</button>' +
            '</div>';
        }
        listEl.innerHTML = html;

        listEl.onclick = function (e) {
          const item = e.target.closest('.lesson-item');
          if (!item) return;
          const lessonId = item.getAttribute('data-lessonid');
          const action = item.getAttribute('data-action');
          if (!lessonId) return;

          if (action === 'review') return openResultForLesson(lessonId);
          if (action === 'start') {
            const lesson = (allLessons || []).find(l => String(l.lessonId) === String(lessonId));
            if (lesson) startLesson(lesson);
          }
        };

        updateProgressSummary(list);
      }

      function updateProgressSummary(list) {
        const box = $('progressSummary');
        if (!box) return;

        if (!list || !list.length) {
          box.innerHTML = '<div class="small muted">Ch∆∞a c√≥ d·ªØ li·ªáu ti·∫øn ƒë·ªô.</div>';
          return;
        }

        let total = list.length, done = 0, pass = 0, fail = 0;
        for (let i = 0; i < list.length; i++) {
          const lesson = list[i];
          const statusText = String(lesson.statusText || '').toUpperCase();
          if (lesson.done || statusText.startsWith('PASS') || statusText.startsWith('FAIL')) done++;
          if (statusText.startsWith('PASS')) pass++;
          if (statusText.startsWith('FAIL')) fail++;
        }

        const donePercent = Math.round((done / total) * 100);

        box.innerHTML =
          '<div class="progress-summary-header">Ti·∫øn ƒë·ªô h·ªçc t·∫≠p</div>' +
          '<div class="progress-summary-bar">' +
            '<div class="progress-bar-track">' +
              '<div class="progress-bar-fill" style="width:' + donePercent + '%;"></div>' +
            '</div>' +
          '</div>' +
          '<div class="progress-summary-meta small">' +
            '<span>' + done + '/' + total + ' b√†i ƒë√£ l√†m</span>' +
            '<span>PASS: ' + pass + ' ‚Ä¢ FAIL: ' + fail + '</span>' +
            '<span>Ho√†n th√†nh: ' + donePercent + '%</span>' +
          '</div>';
      }

      function loadLessons() {
        if (!currentEmployee) return;

        const listEl = $('lessonsList');
        listEl.innerHTML = '<div class="small muted">ƒêang t·∫£i danh s√°ch b√†i h·ªçc...</div>';

        backendGetLessonsForEmployee(currentEmployee.employeeId)
          .then(function (list) {
            allLessons = list || [];
            renderLessons(allLessons);

            const prog = $('progressSummary');
            if (prog) prog.style.display = 'block';
          })
          .catch(function (err) {
            listEl.innerHTML = '<div class="small muted">Kh√¥ng th·ªÉ t·∫£i danh s√°ch b√†i h·ªçc: ' + (err && err.message ? err.message : err) + '</div>';
          });}

      function startLesson(lesson) {
        currentLesson = lesson;
        quizInProgress = true;
        blurCount = 0;

        $('lessonTitle').textContent = lesson.lessonName;
        $('quizArea').style.display = 'block';

        const container = $('questionsContainer');
        container.innerHTML = '<div class="small muted">ƒêang t·∫£i c√¢u h·ªèi...</div>';

        backendGetQuestions(lesson.lessonId)
          .then(function (questions) {
            currentQuestions = questions || [];
            if (!currentQuestions.length) {
              container.innerHTML = '<div class="small muted">Kh√¥ng t√¨m th·∫•y c√¢u h·ªèi cho b√†i h·ªçc n√†y.</div>';
              hideTimer(); clearTimer(); quizInProgress = false;
              return;
            }
            renderQuestionsFast();
            startTimer(QUIZ_DURATION_SECONDS);

            const quizArea = $('quizArea');
            if (quizArea) quizArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
          })
          .catch(function (err) {
            container.innerHTML = '<div class="small muted">Kh√¥ng th·ªÉ t·∫£i c√¢u h·ªèi: ' + (err && err.message ? err.message : err) + '</div>';
            hideTimer(); clearTimer(); quizInProgress = false;
          });}

      function renderQuestionsFast() {
        const container = $('questionsContainer');
        let html = '';

        for (let i = 0; i < currentQuestions.length; i++) {
          const q = currentQuestions[i];
          html += '<div class="question-item">';
          html += '<div class="question-title">' + (i + 1) + '. ' + escapeHtml(q.questionText) + '</div>';
          html += '<div class="options-group">';
          const opts = q.options || [];
          for (let j = 0; j < opts.length; j++) {
            html +=
              '<label class="option-row">' +
                '<input type="radio" name="q_' + escapeAttr(q.questionId) + '" value="' + (j + 1) + '">' +
                '<span>' + escapeHtml(opts[j]) + '</span>' +
              '</label>';
          }
          html += '</div></div>';
        }

        container.innerHTML = html;
      }

      function startTimer(seconds) {
        clearTimer();
        remainingSeconds = seconds;
        showTimer();
        updateTimerDisplay();

        timerInterval = setInterval(function () {
          remainingSeconds--;
          if (remainingSeconds <= 0) {
            clearTimer();
            remainingSeconds = 0;
            updateTimerDisplay();
            onTimeUp();
          } else {
            updateTimerDisplay();
          }
        }, 1000);
      }

      function clearTimer() { if (timerInterval) { clearInterval(timerInterval); timerInterval = null; } }

      function updateTimerDisplay() {
        const label = $('timerLabel');
        const timerBox = $('quizTimer');
        if (!label || !timerBox) return;

        const m = Math.floor(remainingSeconds / 60);
        const s = remainingSeconds % 60;
        label.textContent = String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');

        if (remainingSeconds <= 60) timerBox.classList.add('danger');
        else timerBox.classList.remove('danger');

        if (remainingSeconds <= 10) timerBox.style.opacity = (remainingSeconds % 2 === 0) ? '1' : '0.35';
        else timerBox.style.opacity = '1';
      }

      function showTimer() { const timerBox = $('quizTimer'); if (timerBox) timerBox.style.display = 'inline-flex'; }
      function hideTimer() { const timerBox = $('quizTimer'); if (timerBox) timerBox.style.display = 'none'; }

      function onTimeUp() {
        document.querySelectorAll('#questionsContainer input[type="radio"]').forEach(function (el) { el.disabled = true; });
        const btn = $('btnSubmitQuiz');
        btn.disabled = true;
        btn.textContent = 'H·∫øt th·ªùi gian';
        quizInProgress = false;

        if (!currentEmployee || !currentLesson || !currentQuestions.length) return;

        const payload = {
          employeeId: currentEmployee.employeeId,
          fullName: currentEmployee.fullName,
          lessonId: currentLesson.lessonId,
          answers: [],
          timeUp: true,
          blurCount: blurCount,
        };

        backendSubmitQuiz(payload)
          .then(function (res) { showResultModal(res); loadLessons(); })
          .catch(function (err) { alert('ƒê√£ h·∫øt th·ªùi gian v√† x·∫£y ra l·ªói khi ghi k·∫øt qu·∫£: ' + (err && err.message ? err.message : err)); });}

      function onSubmitQuiz() {
        if (!currentEmployee || !currentLesson || !currentQuestions.length) return;

        const answers = [];
        let unanswered = 0;

        for (let i = 0; i < currentQuestions.length; i++) {
          const q = currentQuestions[i];
          const radios = document.querySelectorAll('input[name="q_' + q.questionId + '"]');
          let selected = null;
          for (let r = 0; r < radios.length; r++) if (radios[r].checked) { selected = radios[r].value; break; }
          if (!selected) unanswered++;
          answers.push({ questionId: q.questionId, selectedIndex: selected ? Number(selected) : 0 });
        }

        if (unanswered > 0) {
          const confirmSubmit = confirm('Hi·ªán v·∫´n c√≤n ' + unanswered + ' c√¢u ch∆∞a ch·ªçn ƒë√°p √°n. B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i?');
          if (!confirmSubmit) return;
        }

        const payload = {
          employeeId: currentEmployee.employeeId,
          fullName: currentEmployee.fullName,
          lessonId: currentLesson.lessonId,
          answers: answers,
          timeUp: false,
          blurCount: blurCount,
        };

        const btn = $('btnSubmitQuiz');
        btn.disabled = true;
        btn.textContent = 'ƒêang ch·∫•m ƒëi·ªÉm...';

        backendSubmitQuiz(payload)
          .then(function (res) {
            btn.disabled = false;
            btn.textContent = 'N·ªôp b√†i';

            if (!res || !res.success) {
              alert(res && res.message ? res.message : 'Kh√¥ng th·ªÉ n·ªôp b√†i. Vui l√≤ng th·ª≠ l·∫°i.');
              return;
            }

            clearTimer();
            hideTimer();
            quizInProgress = false;

            showResultModal(res);
            loadLessons();
          })
          .catch(function (err) {
            btn.disabled = false;
            btn.textContent = 'N·ªôp b√†i';
            alert('L·ªói h·ªá th·ªëng: ' + (err && err.message ? err.message : err));
          });}

      function showResultModal(res) {
        const modal = $('resultModal');
        const card = $('resultCard');
        const title = $('resultTitle');
        const details = $('resultDetails');

        if (currentLesson && currentLesson.lessonId) lastResults[currentLesson.lessonId] = res;

        const isPass = res.status === 'PASS';

        card.className = 'modal-card ' + (isPass ? 'pass' : 'fail');
        title.className = 'result-title ' + (isPass ? 'pass' : 'fail');

        title.textContent = isPass ? 'Ch√∫c m·ª´ng, b·∫°n ƒë√£ PASS' : 'K·∫øt qu·∫£: FAIL';

        details.innerHTML =
          '‚Ä¢ S·ªë c√¢u ƒë√∫ng: <b>' + res.correct + '/' + res.total + '</b><br>' +
          '‚Ä¢ ƒêi·ªÉm s·ªë: <b>' + res.scorePercent + '%</b><br>' +
          '‚Ä¢ Tr·∫°ng th√°i: <b>' + res.status + '</b><br>' +
          "<span style='font-size:12px;opacity:0.8'>H·ªá th·ªëng ƒë√†o t·∫°o OJT ‚Äì Ph√≤ng Engineering</span>";

        modal.style.display = 'flex';
      }

      function openResultForLesson(lessonId) {
        const res = lastResults[lessonId];
        if (res) showResultModal(res);
        else alert('Hi·ªán ch∆∞a c√≥ d·ªØ li·ªáu chi ti·∫øt cho b√†i ki·ªÉm tra n√†y trong phi√™n l√†m vi·ªác n√†y.');
      }

      function closeResultModal() { $('resultModal').style.display = 'none'; }

      document.addEventListener('DOMContentLoaded', function () {
        const nameInput = $('fullName');
        if (nameInput) nameInput.focus();
      }, { passive: true });

      window.addEventListener('beforeunload', function (e) {
        if (currentLesson && remainingSeconds > 0) { e.preventDefault(); e.returnValue = ''; }
      });

      let lastBlurWarn = 0;
      window.addEventListener('blur', function () {
        if (!quizInProgress || remainingSeconds <= 0) return;
        blurCount++;
        const now = Date.now();
        if (now - lastBlurWarn > 2500) { lastBlurWarn = now; alert('H·ªÜ TH·ªêNG OJT C·∫¢NH B√ÅO'); }
      });

      document.addEventListener('keyup', function (e) {
        if (e.key === 'Enter') {
          const fullName = $('fullName').value.trim();
          const employeeId = $('employeeId').value.trim();
          if (fullName && employeeId) onLogin();
        }
      });

      (function setupLessonSearch() {
        const input = $('lessonSearch');
        if (!input) return;

        input.addEventListener('input', function () {
          const keyword = input.value.trim().toUpperCase();
          if (!keyword) { renderLessons(allLessons); return; }

          const filtered = (allLessons || []).filter(function (lesson) {
            const lid = lesson.lessonId ? String(lesson.lessonId).toUpperCase() : '';
            return lid.indexOf(keyword) !== -1;
          });

          renderLessons(filtered);
        }, { passive: true });
      })();

      (function () {
        const body = document.body;
        const toggle = $('themeToggle');
        if (!toggle) return;

        function applyTheme(mode) {
          if (mode === 'light') body.classList.add('light-mode');
          else body.classList.remove('light-mode');
        }

        const savedTheme = localStorage.getItem('ojtTheme');
        if (savedTheme === 'light') { toggle.checked = true; applyTheme('light'); }
        else applyTheme('dark');

        toggle.addEventListener('change', function () {
          const mode = toggle.checked ? 'light' : 'dark';
          applyTheme(mode);
          localStorage.setItem('ojtTheme', mode);
        }, { passive: true });
      })();

      function escapeHtml(str){
        return String(str ?? '')
          .replaceAll('&','&amp;')
          .replaceAll('<','&lt;')
          .replaceAll('>','&gt;')
          .replaceAll('"','&quot;')
          .replaceAll("'","&#039;");
      }
      function escapeAttr(str){
        return String(str ?? '')
          .replaceAll('"','&quot;')
          .replaceAll("'","&#039;");
      }
    </script>
  </body>
</html>


